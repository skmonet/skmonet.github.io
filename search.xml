<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>vedge-install</title>
    <url>/SDWAN/vedge-install/</url>
    <content><![CDATA[<h1 id="站点vEdge安装手册（基于KVM）"><a href="#站点vEdge安装手册（基于KVM）" class="headerlink" title="站点vEdge安装手册（基于KVM）"></a>站点vEdge安装手册（基于KVM）</h1><p>本文档介绍基于KVM环境的vEdge安装过程，包括可能需要修改的OVS配置。<br>vEdge文件信息：viptela-edge-18.4.4-genericx86-64.qcow2</p>
<h2 id="vEdge安装"><a href="#vEdge安装" class="headerlink" title="vEdge安装"></a>vEdge安装</h2><h3 id="1-上传vEdge文件"><a href="#1-上传vEdge文件" class="headerlink" title="1.上传vEdge文件"></a>1.上传vEdge文件</h3><p>除早期已经部署的vEdge站点，为方便管理，默认情况下将vEdge文件统一存放在/home/appadmin/vedge目录下，目录下包含vEdge镜像与vedge.xml（用于创建vEdge虚拟机）。<br><img src="vEdge%E5%AE%89%E8%A3%85%E6%96%87%E6%A1%A3-1.png" alt="vedge上传" title="vedge上传"></p>
<h3 id="2-创建xml文件"><a href="#2-创建xml文件" class="headerlink" title="2.创建xml文件"></a>2.创建xml文件</h3><p>为方便创建vEdge虚拟机，我们使用xml文件来定义虚拟机的各种参数，并且统一命名为vedge.xml。</p>
<p>创建vedge.xml文件</p>
<pre><code>$ touch vedge.xml</code></pre><p>编辑vedge.xml文件</p>
<pre><code>$ vim vedge.xml</code></pre><p>vedge.xml模板，默认配置为8vcpu、8G内存、使用OVS虚拟交换机、定义4个虚拟网卡。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">domain</span> <span class="attr">type</span>=<span class="string">'kvm'</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>vedge<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">memory</span> <span class="attr">unit</span>=<span class="string">'KiB'</span>&gt;</span>8388608<span class="tag">&lt;/<span class="name">memory</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">currentMemory</span> <span class="attr">unit</span>=<span class="string">'KiB'</span>&gt;</span>8388608<span class="tag">&lt;/<span class="name">currentMemory</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">vcpu</span> <span class="attr">placement</span>=<span class="string">'static'</span>&gt;</span>8<span class="tag">&lt;/<span class="name">vcpu</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">partition</span>&gt;</span>/machine<span class="tag">&lt;/<span class="name">partition</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">os</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span> <span class="attr">arch</span>=<span class="string">'x86_64'</span>&gt;</span>hvm<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">os</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">features</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">acpi</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">apic</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">features</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cpu</span> <span class="attr">mode</span>=<span class="string">'host-passthrough'</span> <span class="attr">check</span>=<span class="string">'none'</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">clock</span> <span class="attr">offset</span>=<span class="string">'utc'</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">on_poweroff</span>&gt;</span>destroy<span class="tag">&lt;/<span class="name">on_poweroff</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">on_reboot</span>&gt;</span>restart<span class="tag">&lt;/<span class="name">on_reboot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">on_crash</span>&gt;</span>restart<span class="tag">&lt;/<span class="name">on_crash</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">devices</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">emulator</span>&gt;</span>/usr/bin/kvm-spice<span class="tag">&lt;/<span class="name">emulator</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">disk</span> <span class="attr">type</span>=<span class="string">'file'</span> <span class="attr">device</span>=<span class="string">'disk'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">driver</span> <span class="attr">name</span>=<span class="string">'qemu'</span> <span class="attr">type</span>=<span class="string">'qcow2'</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">source</span> <span class="attr">file</span>=<span class="string">'/home/appadmin/vedge/viptela-edge-18.4.4-genericx86-64.qcow2'</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">target</span> <span class="attr">dev</span>=<span class="string">'vda'</span> <span class="attr">bus</span>=<span class="string">'virtio'</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">boot</span> <span class="attr">order</span>=<span class="string">'1'</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">address</span> <span class="attr">type</span>=<span class="string">'pci'</span> <span class="attr">domain</span>=<span class="string">'0x0000'</span> <span class="attr">bus</span>=<span class="string">'0x00'</span> <span class="attr">slot</span>=<span class="string">'0x09'</span> <span class="attr">function</span>=<span class="string">'0x0'</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">disk</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">controller</span> <span class="attr">type</span>=<span class="string">'usb'</span> <span class="attr">index</span>=<span class="string">'0'</span> <span class="attr">model</span>=<span class="string">'ich9-ehci1'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">address</span> <span class="attr">type</span>=<span class="string">'pci'</span> <span class="attr">domain</span>=<span class="string">'0x0000'</span> <span class="attr">bus</span>=<span class="string">'0x00'</span> <span class="attr">slot</span>=<span class="string">'0x07'</span> <span class="attr">function</span>=<span class="string">'0x7'</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">controller</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">controller</span> <span class="attr">type</span>=<span class="string">'usb'</span> <span class="attr">index</span>=<span class="string">'0'</span> <span class="attr">model</span>=<span class="string">'ich9-uhci1'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">master</span> <span class="attr">startport</span>=<span class="string">'0'</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">address</span> <span class="attr">type</span>=<span class="string">'pci'</span> <span class="attr">domain</span>=<span class="string">'0x0000'</span> <span class="attr">bus</span>=<span class="string">'0x00'</span> <span class="attr">slot</span>=<span class="string">'0x07'</span> <span class="attr">function</span>=<span class="string">'0x0'</span> <span class="attr">multifunction</span>=<span class="string">'on'</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">controller</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">controller</span> <span class="attr">type</span>=<span class="string">'usb'</span> <span class="attr">index</span>=<span class="string">'0'</span> <span class="attr">model</span>=<span class="string">'ich9-uhci2'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">master</span> <span class="attr">startport</span>=<span class="string">'2'</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">address</span> <span class="attr">type</span>=<span class="string">'pci'</span> <span class="attr">domain</span>=<span class="string">'0x0000'</span> <span class="attr">bus</span>=<span class="string">'0x00'</span> <span class="attr">slot</span>=<span class="string">'0x07'</span> <span class="attr">function</span>=<span class="string">'0x1'</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">controller</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">controller</span> <span class="attr">type</span>=<span class="string">'usb'</span> <span class="attr">index</span>=<span class="string">'0'</span> <span class="attr">model</span>=<span class="string">'ich9-uhci3'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">master</span> <span class="attr">startport</span>=<span class="string">'4'</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">address</span> <span class="attr">type</span>=<span class="string">'pci'</span> <span class="attr">domain</span>=<span class="string">'0x0000'</span> <span class="attr">bus</span>=<span class="string">'0x00'</span> <span class="attr">slot</span>=<span class="string">'0x07'</span> <span class="attr">function</span>=<span class="string">'0x2'</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">controller</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">controller</span> <span class="attr">type</span>=<span class="string">'pci'</span> <span class="attr">index</span>=<span class="string">'0'</span> <span class="attr">model</span>=<span class="string">'pci-root'</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">controller</span> <span class="attr">type</span>=<span class="string">'virtio-serial'</span> <span class="attr">index</span>=<span class="string">'0'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">address</span> <span class="attr">type</span>=<span class="string">'pci'</span> <span class="attr">domain</span>=<span class="string">'0x0000'</span> <span class="attr">bus</span>=<span class="string">'0x00'</span> <span class="attr">slot</span>=<span class="string">'0x08'</span> <span class="attr">function</span>=<span class="string">'0x0'</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">controller</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interface</span> <span class="attr">type</span>=<span class="string">'bridge'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">source</span> <span class="attr">bridge</span>=<span class="string">'br-sdwan'</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">vlan</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tag</span> <span class="attr">id</span>=<span class="string">'59'</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">vlan</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">virtualport</span> <span class="attr">type</span>=<span class="string">'openvswitch'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">virtualport</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">model</span> <span class="attr">type</span>=<span class="string">'virtio'</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">address</span> <span class="attr">type</span>=<span class="string">'pci'</span> <span class="attr">domain</span>=<span class="string">'0x0000'</span> <span class="attr">bus</span>=<span class="string">'0x00'</span> <span class="attr">slot</span>=<span class="string">'0x03'</span> <span class="attr">function</span>=<span class="string">'0x0'</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interface</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interface</span> <span class="attr">type</span>=<span class="string">'bridge'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">source</span> <span class="attr">bridge</span>=<span class="string">'br-sdwan'</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">vlan</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tag</span> <span class="attr">id</span>=<span class="string">'2103'</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">vlan</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">virtualport</span> <span class="attr">type</span>=<span class="string">'openvswitch'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">virtualport</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">model</span> <span class="attr">type</span>=<span class="string">'virtio'</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">address</span> <span class="attr">type</span>=<span class="string">'pci'</span> <span class="attr">domain</span>=<span class="string">'0x0000'</span> <span class="attr">bus</span>=<span class="string">'0x00'</span> <span class="attr">slot</span>=<span class="string">'0x04'</span> <span class="attr">function</span>=<span class="string">'0x0'</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interface</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interface</span> <span class="attr">type</span>=<span class="string">'bridge'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">source</span> <span class="attr">bridge</span>=<span class="string">'br-sdwan'</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">vlan</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tag</span> <span class="attr">id</span>=<span class="string">'17'</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">vlan</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">virtualport</span> <span class="attr">type</span>=<span class="string">'openvswitch'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">virtualport</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">model</span> <span class="attr">type</span>=<span class="string">'virtio'</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">address</span> <span class="attr">type</span>=<span class="string">'pci'</span> <span class="attr">domain</span>=<span class="string">'0x0000'</span> <span class="attr">bus</span>=<span class="string">'0x00'</span> <span class="attr">slot</span>=<span class="string">'0x05'</span> <span class="attr">function</span>=<span class="string">'0x0'</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interface</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interface</span> <span class="attr">type</span>=<span class="string">'bridge'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">source</span> <span class="attr">bridge</span>=<span class="string">'br-sdwan'</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">vlan</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tag</span> <span class="attr">id</span>=<span class="string">'2112'</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">vlan</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">virtualport</span> <span class="attr">type</span>=<span class="string">'openvswitch'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">virtualport</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">model</span> <span class="attr">type</span>=<span class="string">'virtio'</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">address</span> <span class="attr">type</span>=<span class="string">'pci'</span> <span class="attr">domain</span>=<span class="string">'0x0000'</span> <span class="attr">bus</span>=<span class="string">'0x00'</span> <span class="attr">slot</span>=<span class="string">'0x06'</span> <span class="attr">function</span>=<span class="string">'0x0'</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interface</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">serial</span> <span class="attr">type</span>=<span class="string">'pty'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">target</span> <span class="attr">port</span>=<span class="string">'0'</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">serial</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">console</span> <span class="attr">type</span>=<span class="string">'pty'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">target</span> <span class="attr">type</span>=<span class="string">'serial'</span> <span class="attr">port</span>=<span class="string">'0'</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">console</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'mouse'</span> <span class="attr">bus</span>=<span class="string">'ps2'</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'keyboard'</span> <span class="attr">bus</span>=<span class="string">'ps2'</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">graphics</span> <span class="attr">type</span>=<span class="string">'vnc'</span> <span class="attr">port</span>=<span class="string">'-1'</span> <span class="attr">autoport</span>=<span class="string">'yes'</span> <span class="attr">listen</span>=<span class="string">'0.0.0.0'</span> <span class="attr">keymap</span>=<span class="string">'en-us'</span> <span class="attr">passwd</span>=<span class="string">'lenovo,!'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">listen</span> <span class="attr">type</span>=<span class="string">'address'</span> <span class="attr">address</span>=<span class="string">'0.0.0.0'</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">graphics</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">video</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">model</span> <span class="attr">type</span>=<span class="string">'qxl'</span> <span class="attr">ram</span>=<span class="string">'65536'</span> <span class="attr">vram</span>=<span class="string">'65536'</span> <span class="attr">vgamem</span>=<span class="string">'16384'</span> <span class="attr">heads</span>=<span class="string">'1'</span> <span class="attr">primary</span>=<span class="string">'yes'</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">address</span> <span class="attr">type</span>=<span class="string">'pci'</span> <span class="attr">domain</span>=<span class="string">'0x0000'</span> <span class="attr">bus</span>=<span class="string">'0x00'</span> <span class="attr">slot</span>=<span class="string">'0x02'</span> <span class="attr">function</span>=<span class="string">'0x0'</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">memballoon</span> <span class="attr">model</span>=<span class="string">'virtio'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">address</span> <span class="attr">type</span>=<span class="string">'pci'</span> <span class="attr">domain</span>=<span class="string">'0x0000'</span> <span class="attr">bus</span>=<span class="string">'0x00'</span> <span class="attr">slot</span>=<span class="string">'0x0a'</span> <span class="attr">function</span>=<span class="string">'0x0'</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">memballoon</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">devices</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">domain</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>每个站点的网卡部分需要特殊注意并修改。  </p>
<ul>
<li>&lt;source bridge&gt;表示服务器OVS定义的虚拟网桥名称；  </li>
<li>&lt;tag id&gt;表示当前接口分配的vlan id。<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">interface</span> <span class="attr">type</span>=<span class="string">'bridge'</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">bridge</span>=<span class="string">'br-sdwan'</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">vlan</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tag</span> <span class="attr">id</span>=<span class="string">'59'</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">vlan</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">virtualport</span> <span class="attr">type</span>=<span class="string">'openvswitch'</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">virtualport</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">model</span> <span class="attr">type</span>=<span class="string">'virtio'</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">address</span> <span class="attr">type</span>=<span class="string">'pci'</span> <span class="attr">domain</span>=<span class="string">'0x0000'</span> <span class="attr">bus</span>=<span class="string">'0x00'</span> <span class="attr">slot</span>=<span class="string">'0x03'</span> <span class="attr">function</span>=<span class="string">'0x0'</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interface</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>每台vEdge定义4个虚拟网卡，</p>
<ul>
<li>第一个&lt;interface&gt;表示eth0，用于VPN512下管理接口；</li>
<li>第二个&lt;interface&gt;表示ge0/0，用于VPN0下，作为MPLS接口；</li>
<li>第三个&lt;interface&gt;表示ge0/1，用于VPN0下，作为Interface接口；</li>
<li>第四个&lt;interface&gt;表示ge0/2，用于VPN10下，作为LAN接口；</li>
</ul>
<blockquote>
<p>注意：在xml文件中不包含MAC地址，虚拟机开机后，系统会自动将MAC地址添加到文件中。</p>
</blockquote>
<h3 id="3-部署vEdge虚拟机"><a href="#3-部署vEdge虚拟机" class="headerlink" title="3.部署vEdge虚拟机"></a>3.部署vEdge虚拟机</h3><p>定义好vedge.xml后，目录内容如下：<br><img src="vEdge%E5%AE%89%E8%A3%85%E6%96%87%E6%A1%A3-2.png" alt="vedge目录下文件" title="vedge目录下文件"></p>
<p>部署vedge虚拟机</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ virsh define vedge.xml</span><br></pre></td></tr></table></figure>

<p>提示<code>Domain vedge defined from vedge.xml</code>表示部署成功。</p>
<blockquote>
<p>注意：部署vedge虚拟机时一定要在/vedge目录下进行。</p>
</blockquote>
<h3 id="4-启动vEdge虚拟机以及常用命令"><a href="#4-启动vEdge虚拟机以及常用命令" class="headerlink" title="4.启动vEdge虚拟机以及常用命令"></a>4.启动vEdge虚拟机以及常用命令</h3><p>部署完成后使用start命令启动虚拟机，通过console命令即可对vEdge进行配置操作。常用命令如下：</p>
<table>
<thead>
<tr>
<th>虚拟机操作</th>
<th>命令格式</th>
</tr>
</thead>
<tbody><tr>
<td>开启虚拟机</td>
<td>virsh start &lt;vm-name&gt;</td>
</tr>
<tr>
<td>登录虚拟机</td>
<td>virsh console &lt;vm-name&gt;</td>
</tr>
<tr>
<td>强关虚拟机</td>
<td>virsh destroy &lt;vm-name&gt;</td>
</tr>
<tr>
<td>删除虚拟机</td>
<td>virsh undefine &lt;vm-name&gt;</td>
</tr>
<tr>
<td>部署虚拟机</td>
<td>virsh define &lt;vm-name&gt;</td>
</tr>
<tr>
<td>查看运行中虚拟机</td>
<td>virsh list</td>
</tr>
<tr>
<td>查看全部虚拟机</td>
<td>virsh list –all</td>
</tr>
</tbody></table>
<h3 id="5-修改已经部署的vEdge虚拟机参数"><a href="#5-修改已经部署的vEdge虚拟机参数" class="headerlink" title="5.修改已经部署的vEdge虚拟机参数"></a>5.修改已经部署的vEdge虚拟机参数</h3><p>需要修改已经部署的vEdge虚拟机参数时，不再使用vedge.xml（vedge.xml只用于部署虚拟机），使用edit命令来调整虚拟机参数。先关闭虚拟机，再修改参数。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ virsh edit &lt;vm-name&gt;</span><br></pre></td></tr></table></figure>

<h3 id="6-配置vEdge虚拟机自动启动"><a href="#6-配置vEdge虚拟机自动启动" class="headerlink" title="6.配置vEdge虚拟机自动启动"></a>6.配置vEdge虚拟机自动启动</h3><p>使用命令autostart配置虚拟机自动启动：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ virsh autostart &lt;vm-name&gt;</span><br></pre></td></tr></table></figure>
<p>进入/etc/libvirt/qemu/autostart目录，查看是否有&lt;vm-name&gt;.xml的文件存在，如果存在表示自启动配置成功。删除对应xml文件，关闭虚拟机自启动。<br><img src="vEdge%E5%AE%89%E8%A3%85%E6%96%87%E6%A1%A3-3.png" alt="vedge自动启动" title="vedge自动启动"></p>
<h1 id="二、-OVS配置修改（可选）"><a href="#二、-OVS配置修改（可选）" class="headerlink" title="二、    OVS配置修改（可选）"></a>二、    OVS配置修改（可选）</h1><p>vEdge所在的宿主服务器对网卡进行基于ubuntu的bond配置，配置步骤如下：</p>
<h3 id="1-检查所需要的组件以及信息"><a href="#1-检查所需要的组件以及信息" class="headerlink" title="1.检查所需要的组件以及信息"></a>1.检查所需要的组件以及信息</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ ls -l &#x2F;lib&#x2F;modules&#x2F;&#96;uname -r&#96;&#x2F;kernel&#x2F;drivers&#x2F;net&#x2F;bonding&#x2F;bonding.ko</span><br><span class="line">$ modprobe bonding</span><br><span class="line">$ lsmod | grep bonding</span><br><span class="line">$ dpkg -l | grep ifenslave</span><br></pre></td></tr></table></figure>

<p>如果<code>$ dpkg -l | grep ifenslave</code>没有输出，执行以下命令进行安装：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ apt install ifenslave</span><br></pre></td></tr></table></figure>

<h3 id="2-修改interface文件"><a href="#2-修改interface文件" class="headerlink" title="2.修改interface文件"></a>2.修改interface文件</h3><p>不同服务器做bond配置时接口数量不同，根据实际情况修改</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ vim &#x2F;etc&#x2F;network&#x2F;interfaces</span><br></pre></td></tr></table></figure>
<p>在每个接口下面添加代码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bond-master bond0</span><br></pre></td></tr></table></figure>

<p>在最后添加bond接口代码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">auto bond0</span><br><span class="line">iface bond0 inet manual</span><br><span class="line">    bond-mode 4</span><br><span class="line">    bond-lacp-rate 1</span><br><span class="line">    bond-miimon 100</span><br><span class="line">    bond-slaves none</span><br><span class="line">    bond-xmit-hash-policy layer3+4</span><br></pre></td></tr></table></figure>

<h3 id="3-修改OVS"><a href="#3-修改OVS" class="headerlink" title="3.修改OVS"></a>3.修改OVS</h3><p>如果已经部署过OVS的bond0，需要先删除，然后重新添加</p>
<p>删除原有的bond0</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ ovs-vsctl del-port br-sdwan bond0</span><br></pre></td></tr></table></figure>

<h3 id="4-启动新bond0"><a href="#4-启动新bond0" class="headerlink" title="4.启动新bond0"></a>4.启动新bond0</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ifup bond0</span><br></pre></td></tr></table></figure>
<p>此时系统会提示60秒等待接口加入，可以直接ctrl+c暂停。</p>
<h3 id="5-将接口加入bond0"><a href="#5-将接口加入bond0" class="headerlink" title="5.将接口加入bond0"></a>5.将接口加入bond0</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ifenslave bond0 ens1f0 ens2f0 ens1f1 ens2f1</span><br></pre></td></tr></table></figure>
<blockquote>
<p>根据站点服务器型号输入接口名称与接口数量</p>
</blockquote>
<h3 id="6-查看bond0信息"><a href="#6-查看bond0信息" class="headerlink" title="6.查看bond0信息"></a>6.查看bond0信息</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &#x2F;proc&#x2F;net&#x2F;bonding&#x2F;bond0</span><br></pre></td></tr></table></figure>
<p>可以看到加入到bond0的接口数量与模式</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Bonding Mode: IEEE 802.3ad Dynamic link aggregation</span><br><span class="line">Transmit Hash Policy: layer3+4 (1)</span><br><span class="line">port number: 4</span><br></pre></td></tr></table></figure>

<h3 id="7-将新bond0加入到OVS"><a href="#7-将新bond0加入到OVS" class="headerlink" title="7.将新bond0加入到OVS"></a>7.将新bond0加入到OVS</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ovs-vsctl add-port br-sdwan bond0</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>SDWAN</category>
      </categories>
      <tags>
        <tag>SD-WAN</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/other/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
      <categories>
        <category>other</category>
      </categories>
      <tags>
        <tag>tag1</tag>
      </tags>
  </entry>
  <entry>
    <title>test.md</title>
    <url>/UC/test-md/</url>
    <content><![CDATA[<h1 id="test-md"><a href="#test-md" class="headerlink" title="test md"></a>test md</h1><p>abc</p>
<p>123</p>
<h1 id="end"><a href="#end" class="headerlink" title="end"></a>end</h1>]]></content>
      <categories>
        <category>UC</category>
      </categories>
      <tags>
        <tag>tag1</tag>
      </tags>
  </entry>
</search>
